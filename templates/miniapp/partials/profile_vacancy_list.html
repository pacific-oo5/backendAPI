<style>
    .vacancy-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .vacancy-card {
        background-color: var(--tg-theme-secondary-bg-color, #f8f9fa);
        border-radius: 20px;
        padding: 24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border: 1px solid transparent;
        cursor: pointer;
        position: relative;
    }

    .vacancy-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        border-color: var(--tg-theme-button-color, #40a7e3);
    }

    .vacancy-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--tg-theme-text-color, #000000);
        line-height: 1.4;
        padding-right: 40px;
    }

    .vacancy-salary {
        font-size: 16px;
        font-weight: 700;
        color: #10b981;
        margin-bottom: 8px;
    }

    .vacancy-location {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--tg-theme-hint-color, #666666);
        margin-bottom: 12px;
        font-size: 14px;
        font-weight: 500;
    }

    .vacancy-description {
        color: var(--tg-theme-text-color, #000000);
        margin-bottom: 16px;
        font-size: 14px;
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .vacancy-meta {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 16px;
    }

    .meta-tag {
        background: linear-gradient(135deg, var(--tg-theme-button-color, #40a7e3), #2d8ac7);
        color: var(--tg-theme-button-text-color, #ffffff);
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        letter-spacing: -0.2px;
    }

    /* –ú–µ–Ω—é —Ç—Ä–µ—Ö —Ç–æ—á–µ–∫ */
    .vacancy-menu {
        position: absolute;
        top: 20px;
        right: 20px;
    }

    .menu-toggle {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: transparent;
        border: none;
    }

    .menu-toggle:hover {
        background-color: rgba(0, 0, 0, 0.1);
    }

    .menu-dot {
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background-color: var(--tg-theme-hint-color, #666666);
        position: relative;
    }

    .menu-dot::before,
    .menu-dot::after {
        content: '';
        position: absolute;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background-color: var(--tg-theme-hint-color, #666666);
        left: 0;
    }

    .menu-dot::before {
        top: -8px;
    }

    .menu-dot::after {
        top: 8px;
    }

    .menu-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        background: var(--tg-theme-bg-color, #ffffff);
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        padding: 8px;
        min-width: 160px;
        z-index: 1000;
        display: none;
        border: 1px solid var(--tg-theme-secondary-bg-color, #f0f0f0);
    }

    .menu-dropdown.show {
        display: block;
    }

    .menu-item {
        padding: 12px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 14px;
        font-weight: 500;
        color: var(--tg-theme-text-color, #000000);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .menu-item:hover {
        background-color: var(--tg-theme-secondary-bg-color, #f8f9fa);
    }

    .menu-item.statistics {
        color: #3b82f6;
    }

    .menu-item.edit {
        color: #f59e0b;
    }

    .menu-item.delete {
        color: #ef4444;
    }

    /* –ò–∫–æ–Ω–∫–∏ –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é */
    .menu-icon {
        width: 16px;
        height: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>

<div class="vacancy-list">
    {% for vacancy in vacancies %}
    <div class="vacancy-card" data-vacancy-id="{{ vacancy.id }}">
        <!-- –ú–µ–Ω—é —Ç—Ä–µ—Ö —Ç–æ—á–µ–∫ -->
        <div class="vacancy-menu">
            <button class="menu-toggle" onclick="toggleMenu(this)">
                <span class="menu-dot"></span>
            </button>
            <div class="menu-dropdown">
                <div class="menu-item statistics" onclick="showStatistics({{ vacancy.id }})">
                    <span class="menu-icon">üìä</span>
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </div>
                <div class="menu-item edit" onclick="editVacancy({{ vacancy.id }})">
                    <span class="menu-icon">‚úèÔ∏è</span>
                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </div>
                <div class="menu-item delete" onclick="deleteVacancy({{ vacancy.id }})">
                    <span class="menu-icon">üóëÔ∏è</span>
                    –£–¥–∞–ª–∏—Ç—å
                </div>
            </div>
        </div>

        <h3 class="vacancy-title">{{ vacancy.title }}</h3>

        {% if vacancy.salary %}
        <div class="vacancy-salary">
            {{ vacancy.salary }} ‚ÇΩ
        </div>
        {% endif %}

        {% if vacancy.location %}
        <div class="vacancy-location">
            üìç {{ vacancy.location }}
        </div>
        {% endif %}

        {% if vacancy.description %}
        <div class="vacancy-description">
            {{ vacancy.description }}
        </div>
        {% endif %}

        <div class="vacancy-meta">
            {% if vacancy.experience %}
            <span class="meta-tag">–û–ø—ã—Ç: {{ vacancy.experience }}</span>
            {% endif %}

            {% if vacancy.employment_type %}
            <span class="meta-tag">{{ vacancy.employment_type }}</span>
            {% endif %}

            {% if vacancy.remote %}
            <span class="meta-tag">–£–¥–∞–ª—ë–Ω–Ω–æ</span>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="vacancy-card">
        <h3 class="vacancy-title">–í–∞–∫–∞–Ω—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π</p>
    </div>
    {% endfor %}
</div>

<script>
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º
document.addEventListener('click', function(e) {
    // –ú–µ–Ω—é —Ç—Ä–µ—Ö —Ç–æ—á–µ–∫
    if (e.target.closest('.menu-toggle')) {
        const button = e.target.closest('.menu-toggle');
        const dropdown = button.nextElementSibling;
        const isShowing = dropdown.classList.contains('show');

        document.querySelectorAll('.menu-dropdown.show').forEach(menu => {
            if (menu !== dropdown) menu.classList.remove('show');
        });

        if (!isShowing) dropdown.classList.add('show');
        else dropdown.classList.remove('show');

        e.stopPropagation();
    }

    // –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é
    else if (e.target.closest('.menu-item.statistics')) {
        const vacancyId = e.target.closest('.vacancy-card').dataset.vacancyId;
        showVacancyStatistics(vacancyId);
    }
    else if (e.target.closest('.menu-item.edit')) {
        const vacancyId = e.target.closest('.vacancy-card').dataset.vacancyId;
        editVacancy(vacancyId);
    }
    else if (e.target.closest('.menu-item.delete')) {
        const vacancyId = e.target.closest('.vacancy-card').dataset.vacancyId;
        deleteVacancy(vacancyId);
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    else {
        document.querySelectorAll('.menu-dropdown.show').forEach(menu => {
            menu.classList.remove('show');
        });
    }
});

// –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
function showVacancyStatistics(vacancyId) {
    Telegram.WebApp.showPopup({
        title: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
        message: `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–∞–∫–∞–Ω—Å–∏–∏ #${vacancyId}`,
        buttons: [{type: 'ok'}]
    });
}

function editVacancy(vacancyId) {
    Telegram.WebApp.showPopup({
        title: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
        message: `–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ #${vacancyId}`,
        buttons: [{type: 'ok'}]
    });
}

function deleteVacancy(vacancyId) {
    Telegram.WebApp.showConfirm(
        '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é?',
        function(result) {
            if (result) {
                // –ó–¥–µ—Å—å API –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
                fetch(`/api/vacancies/${vacancyId}/delete/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Telegram.WebApp.showPopup({
                            title: '–£—Å–ø–µ—à–Ω–æ',
                            message: '–í–∞–∫–∞–Ω—Å–∏—è —É–¥–∞–ª–µ–Ω–∞',
                            buttons: [{type: 'ok'}]
                        });
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                        loadItems(1);
                    }
                });
            }
        }
    );
}

function getCSRFToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
}
</script>